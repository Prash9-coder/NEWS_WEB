// src/data/epaperData.js

// Edition Categories - Sakshi Style
export const editionCategories = [
    {
        id: 'main',
        name: 'MAIN EDITIONS',
        color: '#e31e24',
        editions: [
            {
                id: 'delhi',
                name: 'Delhi',
                nameLocal: 'ఢిల్లీ',
                thumbnail: 'https://picsum.photos/seed/delhi-main/400/560',
                pagesCount: 24,
            },
            {
                id: 'national',
                name: 'National',
                nameLocal: 'నేషనల్',
                thumbnail: 'https://picsum.photos/seed/national-main/400/560',
                pagesCount: 28,
            },
        ]
    },
    {
        id: 'andhra-pradesh',
        name: 'ANDHRA PRADESH',
        color: '#1a73e8',
        editions: [
            {
                id: 'vijayawada',
                name: 'Vijayawada',
                nameLocal: 'విజయవాడ',
                thumbnail: 'https://picsum.photos/seed/vijayawada/400/560',
                pagesCount: 24,
            },
            {
                id: 'visakhapatnam',
                name: 'Visakhapatnam',
                nameLocal: 'విశాఖపట్నం',
                thumbnail: 'https://picsum.photos/seed/vizag/400/560',
                pagesCount: 20,
            },
            {
                id: 'tirupati',
                name: 'Tirupati',
                nameLocal: 'తిరుపతి',
                thumbnail: 'https://picsum.photos/seed/tirupati/400/560',
                pagesCount: 18,
            },
            {
                id: 'guntur',
                name: 'Guntur',
                nameLocal: 'గుంటూరు',
                thumbnail: 'https://picsum.photos/seed/guntur/400/560',
                pagesCount: 16,
            },
            {
                id: 'rajahmundry',
                name: 'Rajahmundry',
                nameLocal: 'రాజమహేంద్రవరం',
                thumbnail: 'https://picsum.photos/seed/rajahmundry/400/560',
                pagesCount: 16,
            },
            {
                id: 'nellore',
                name: 'Nellore',
                nameLocal: 'నెల్లూరు',
                thumbnail: 'https://picsum.photos/seed/nellore/400/560',
                pagesCount: 14,
            },
            {
                id: 'kurnool',
                name: 'Kurnool',
                nameLocal: 'కర్నూలు',
                thumbnail: 'https://picsum.photos/seed/kurnool/400/560',
                pagesCount: 14,
            },
            {
                id: 'anantapur',
                name: 'Anantapur',
                nameLocal: 'అనంతపురం',
                thumbnail: 'https://picsum.photos/seed/anantapur/400/560',
                pagesCount: 12,
            },
            {
                id: 'kadapa',
                name: 'Kadapa',
                nameLocal: 'కడప',
                thumbnail: 'https://picsum.photos/seed/kadapa/400/560',
                pagesCount: 12,
            },
            {
                id: 'ongole',
                name: 'Ongole',
                nameLocal: 'ఒంగోలు',
                thumbnail: 'https://picsum.photos/seed/ongole/400/560',
                pagesCount: 12,
            },
            {
                id: 'eluru',
                name: 'Eluru',
                nameLocal: 'ఏలూరు',
                thumbnail: 'https://picsum.photos/seed/eluru/400/560',
                pagesCount: 12,
            },
            {
                id: 'srikakulam',
                name: 'Srikakulam',
                nameLocal: 'శ్రీకాకుళం',
                thumbnail: 'https://picsum.photos/seed/srikakulam/400/560',
                pagesCount: 10,
            },
        ]
    },
    {
        id: 'telangana',
        name: 'TELANGANA',
        color: '#ff9800',
        editions: [
            {
                id: 'hyderabad',
                name: 'Hyderabad',
                nameLocal: 'హైదరాబాద్',
                thumbnail: 'https://picsum.photos/seed/hyderabad/400/560',
                pagesCount: 28,
            },
            {
                id: 'warangal',
                name: 'Warangal',
                nameLocal: 'వరంగల్',
                thumbnail: 'https://picsum.photos/seed/warangal/400/560',
                pagesCount: 16,
            },
            {
                id: 'karimnagar',
                name: 'Karimnagar',
                nameLocal: 'కరీంనగర్',
                thumbnail: 'https://picsum.photos/seed/karimnagar/400/560',
                pagesCount: 14,
            },
            {
                id: 'khammam',
                name: 'Khammam',
                nameLocal: 'ఖమ్మం',
                thumbnail: 'https://picsum.photos/seed/khammam/400/560',
                pagesCount: 14,
            },
            {
                id: 'nizamabad',
                name: 'Nizamabad',
                nameLocal: 'నిజామాబాద్',
                thumbnail: 'https://picsum.photos/seed/nizamabad/400/560',
                pagesCount: 12,
            },
            {
                id: 'nalgonda',
                name: 'Nalgonda',
                nameLocal: 'నల్గొండ',
                thumbnail: 'https://picsum.photos/seed/nalgonda/400/560',
                pagesCount: 12,
            },
            {
                id: 'mahabubnagar',
                name: 'Mahabubnagar',
                nameLocal: 'మహబూబ్‌నగర్',
                thumbnail: 'https://picsum.photos/seed/mahabubnagar/400/560',
                pagesCount: 12,
            },
            {
                id: 'adilabad',
                name: 'Adilabad',
                nameLocal: 'ఆదిలాబాద్',
                thumbnail: 'https://picsum.photos/seed/adilabad/400/560',
                pagesCount: 10,
            },
        ]
    },
    {
        id: 'metro',
        name: 'METRO',
        color: '#9c27b0',
        editions: [
            {
                id: 'hyderabad-metro',
                name: 'Hyderabad Metro',
                nameLocal: 'హైదరాబాద్ మెట్రో',
                thumbnail: 'https://picsum.photos/seed/hyd-metro/400/560',
                pagesCount: 8,
            },
            {
                id: 'vijayawada-metro',
                name: 'Vijayawada Metro',
                nameLocal: 'విజయవాడ మెట్రో',
                thumbnail: 'https://picsum.photos/seed/vij-metro/400/560',
                pagesCount: 8,
            },
            {
                id: 'vizag-metro',
                name: 'Vizag Metro',
                nameLocal: 'విశాఖ మెట్రో',
                thumbnail: 'https://picsum.photos/seed/vizag-metro/400/560',
                pagesCount: 8,
            },
        ]
    },
    {
        id: 'magazines',
        name: 'MAGAZINES',
        color: '#4caf50',
        editions: [
            {
                id: 'funday',
                name: 'Funday',
                nameLocal: 'ఫన్‌డే',
                thumbnail: 'https://picsum.photos/seed/funday/400/560',
                pagesCount: 16,
                isWeekly: true,
            },
            {
                id: 'navya',
                name: 'Navya',
                nameLocal: 'నవ్య',
                thumbnail: 'https://picsum.photos/seed/navya/400/560',
                pagesCount: 24,
                isWeekly: true,
            },
            {
                id: 'family',
                name: 'Family',
                nameLocal: 'ఫ్యామిలీ',
                thumbnail: 'https://picsum.photos/seed/family/400/560',
                pagesCount: 20,
                isWeekly: true,
            },
            {
                id: 'sakshi-sport',
                name: 'Sakshi Sport',
                nameLocal: 'సాక్షి స్పోర్ట్',
                thumbnail: 'https://picsum.photos/seed/sport/400/560',
                pagesCount: 12,
            },
            {
                id: 'business',
                name: 'Business',
                nameLocal: 'బిజినెస్',
                thumbnail: 'https://picsum.photos/seed/business-mag/400/560',
                pagesCount: 12,
            },
        ]
    },
];

// ==================== HELPER FUNCTIONS ====================

// Get all editions as flat list
export const getAllEditions = () => {
    const allEditions = [];
    editionCategories.forEach(category => {
        category.editions.forEach(edition => {
            allEditions.push({
                ...edition,
                category: category.name,
                categoryId: category.id,
                categoryColor: category.color,
            });
        });
    });
    return allEditions;
};

// Find edition by ID
export const findEditionById = (editionId) => {
    for (const category of editionCategories) {
        const edition = category.editions.find(e => e.id === editionId);
        if (edition) {
            return {
                ...edition,
                category: category.name,
                categoryId: category.id,
                categoryColor: category.color,
            };
        }
    }
    return null;
};

// ==================== DATE FUNCTIONS ====================

// Get available dates (last 30 days)
export const getAvailableDates = () => {
    const dates = [];
    for (let i = 0; i < 30; i++) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        dates.push({
            date: date,
            formatted: date.toLocaleDateString('en-IN', {
                weekday: 'short',
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            }),
            displayDate: date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            }),
            urlDate: `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`,
            value: date.toISOString().split('T')[0],
            day: date.getDate(),
            month: date.toLocaleDateString('en-IN', { month: 'short' }),
            year: date.getFullYear(),
            weekday: date.toLocaleDateString('en-IN', { weekday: 'short' }),
            isToday: i === 0,
            isYesterday: i === 1,
        });
    }
    return dates;
};

// ==================== LOCALSTORAGE FUNCTIONS ====================

// Get saved epaper from localStorage
export const getSavedEpaper = (editionId, date) => {
    try {
        const saved = JSON.parse(localStorage.getItem('epaperUploads') || '[]');
        return saved.find(e => e.edition === editionId && e.date === date);
    } catch (error) {
        console.error('Error reading from localStorage:', error);
        return null;
    }
};

// Get all saved epapers
export const getAllSavedEpapers = () => {
    try {
        return JSON.parse(localStorage.getItem('epaperUploads') || '[]');
    } catch (error) {
        console.error('Error reading from localStorage:', error);
        return [];
    }
};

// Save epaper to localStorage
export const saveEpaper = (epaperData) => {
    try {
        const existingData = getAllSavedEpapers();

        // Remove existing entry for same edition and date
        const filteredData = existingData.filter(
            e => !(e.edition === epaperData.edition && e.date === epaperData.date)
        );

        // Add new data at beginning
        filteredData.unshift(epaperData);

        localStorage.setItem('epaperUploads', JSON.stringify(filteredData));
        return true;
    } catch (error) {
        console.error('Error saving to localStorage:', error);
        return false;
    }
};

// Delete epaper from localStorage
export const deleteEpaper = (id) => {
    try {
        const existingData = getAllSavedEpapers();
        const filteredData = existingData.filter(e => e.id !== id);
        localStorage.setItem('epaperUploads', JSON.stringify(filteredData));
        return true;
    } catch (error) {
        console.error('Error deleting from localStorage:', error);
        return false;
    }
};

// ==================== PAGE GENERATION ====================

// Get page title based on page number
const getPageTitle = (pageNum, total) => {
    if (pageNum === 1) return 'Front Page';
    if (pageNum === total) return 'Back Page';
    if (pageNum === 2) return 'City';
    if (pageNum === 3) return 'State';
    if (pageNum <= 6) return 'District';
    if (pageNum <= 10) return 'National';
    if (pageNum <= 14) return 'International';
    if (pageNum <= 18) return 'Sports';
    if (pageNum <= 22) return 'Entertainment';
    return 'Classifieds';
};

// Generate pages for an edition - Checks localStorage first
export const generatePagesForEdition = (editionId, pageCount = 24, date = null) => {
    const currentDate = date || new Date().toISOString().split('T')[0];

    // Check if we have uploaded pages in localStorage
    const savedEpaper = getSavedEpaper(editionId, currentDate);

    if (savedEpaper && savedEpaper.pages && savedEpaper.pages.length > 0) {
        // Return saved pages from localStorage
        return savedEpaper.pages.map((page, index) => ({
            id: `${editionId}-${index + 1}`,
            pageNumber: page.pageNumber || index + 1,
            thumbnail: page.url,
            fullImage: page.url,
            hdImage: page.url,
            title: getPageTitle(index + 1, savedEpaper.pages.length),
        }));
    }

    // Fallback to placeholder images (picsum)
    const pages = [];
    for (let i = 1; i <= pageCount; i++) {
        pages.push({
            id: `${editionId}-${i}`,
            pageNumber: i,
            thumbnail: `https://picsum.photos/seed/${editionId}-p${i}/200/280`,
            fullImage: `https://picsum.photos/seed/${editionId}-p${i}/900/1260`,
            hdImage: `https://picsum.photos/seed/${editionId}-p${i}-hd/1800/2520`,
            title: getPageTitle(i, pageCount),
        });
    }
    return pages;
};

// Check if epaper exists for edition and date
export const hasEpaperForDate = (editionId, date) => {
    const savedEpaper = getSavedEpaper(editionId, date);
    return savedEpaper && savedEpaper.pages && savedEpaper.pages.length > 0;
};

// Get epaper stats
export const getEpaperStats = () => {
    const allEpapers = getAllSavedEpapers();
    return {
        totalEpapers: allEpapers.length,
        totalPages: allEpapers.reduce((acc, e) => acc + (e.pagesCount || 0), 0),
        editions: [...new Set(allEpapers.map(e => e.edition))].length,
    };
};